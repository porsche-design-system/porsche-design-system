(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cd45cb70"],{"0840":function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-01.08504bb3.jpg"},"0ac2":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmark"},[t("h1",[e._v("Initialization")]),t("p",[e._v("First we need to understand how a web component works, before we can look into how to optimize its bootstrapping behavior.")]),t("TableOfContents"),t("h2",[e._v("Setup")]),e._m(0),e._m(1),e._m(2),e._m(3),e._m(4),t("p",[e._v("Now the Porsche Design System is active and ready to go.")]),t("h2",[e._v("Preparation")]),e._m(5),e._m(6),e._m(7),e._m(8),e._m(9),e._m(10),t("h2",[e._v("Connect Lifecycle")]),e._m(11),t("Notification",{attrs:{heading:"Important","heading-tag":"h3",state:"warning"}},[e._v(" It is important to understand, that for each component tag in the DOM, there is a component class instance in the JavaScript space. The component tag acts as an interface, similar to an API, where you set attributes/properties or children as inputs. If these change, the class instance detects these and renders the result into the component tag's Shadow DOM as an output. ")]),e._m(12),e._m(13),e._m(14),e._m(15),e._m(16),t("p",[e._v("Which makes the button appear like you are used to.")]),t("p",[t("p-button",{attrs:{theme:this.$store.getters.storefrontTheme}},[e._v("Hello")])],1),t("h2",[e._v("Change Lifecycle")]),t("p",[e._v("In case of an attribute or property change, the class instance goes through the following lifecycle methods in order.")]),e._m(17),t("p",[e._v("This means that upon attribute or property change (sometimes also added/removed children for more interactive components) the web component re-renders and updates its Shadow DOM.")]),t("h2",[e._v("Disconnect Lifecycle")]),e._m(18),e._m(19),t("p",[e._v("This is typically used to remove previously added event listeners, destroy watchers and other cleanup tasks.")]),t("h2",[e._v("Reconnect Lifecycle")]),e._m(20),e._m(21),t("p",[e._v("This typically doesn't happen in framework environments but is possible in theory or with straight DOM manipulation.")]),e._m(22),t("hr"),t("h2",[e._v("Optimization")]),e._m(23),t("h3",[e._v("Status Quo")]),t("p",[e._v("By default, the network traffic looks something like this.")]),e._m(24),t("p",[e._v("A classic waterfall like loading behavior that")]),e._m(25),t("h3",[e._v("Preloading font-face.css")]),e._m(26),e._m(27),e._m(28),t("h3",[e._v("Preloading font files")]),e._m(29),e._m(30),e._m(31),t("h3",[e._v("Preloading component chunks")]),e._m(32),e._m(33),t("p",[e._v("Again, with this improvement, the asset is now being loaded in parallel, too.")]),e._m(34),e._m(35),e._m(36),t("p",[e._v("Now, everything is preloaded in parallel.")]),t("Notification",{attrs:{heading:"Hint","heading-tag":"h4",state:"warning"}},[e._v(" Just preloading all component chunks on the page or even every chunk available should be avoided."),t("br"),e._v(" Instead, the most performant but also more complicated approach would be to only preload the component chunks (and fonts) that are located "),t("strong",[e._v("above the fold")]),e._v(" which means visible on page load without scrolling. ")]),t("h3",[e._v("Early initialization")]),e._m(37),e._m(38),e._m(39),t("Notification",{attrs:{heading:"Hint","heading-tag":"h4",state:"warning"}},[e._v(" This works and helps especially in a plain HTML and Vanilla Js setup since the "),t("code",[e._v("index.js")]),e._v(" is otherwise bundled by the JavaScript framework and you would end up shipping the same code twice, once bundled and once inlined in the "),t("code",[e._v("script")]),e._v(" tag. ")])],1)},a=[function(){var e=this,t=e._self._c;return t("p",[e._v("The most basic "),t("a",{attrs:{href:"developing/vanilla-js/getting-started#integration"}},[e._v("integration")]),e._v(" of "),t("code",[e._v("@porsche-design-system/components-js")]),e._v(" without any bundler after loading the npm package on any html page looks like this.")])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-html"},[e._v("<script>\n  porscheDesignSystem.load();\n<\/script>\n")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("Executing the "),t("code",[e._v("load()")]),e._v(" function loads the "),t("strong",[e._v("core chunk")]),e._v(" from the CDN. The core chunk can easily be identified in the network tab of Chrome Developer Tools by its name containing the version number, e.g. "),t("code",[e._v("porsche-design-system.v3.8.0.688f651c1314ab84fa7b.js")]),e._v(".")])},function(){var e=this,t=e._self._c;return t("p",[e._v("Once the "),t("strong",[e._v("core chunk")]),e._v(" is loaded and executed the following things happen:")])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[t("code",[e._v("customElements.define()")]),e._v(" is called for every component to register the custom html element in the browser (this is how "),t("a",{attrs:{href:"developing/vanilla-js/advanced"}},[e._v("prefixing")]),e._v(" for micro frontend architectures is even possible)")]),t("li",[e._v("if any of the registered component tags is already in or is later added to the DOM, its corresponding "),t("strong",[e._v("component chunk")]),e._v(" is loaded from the CDN on demand")]),t("li",[e._v("a checklist is maintained that tracks which "),t("strong",[e._v("component chunks")]),e._v(" are loaded already")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("In the example from above we didn't render any component, yet, so let's add a single "),t("code",[e._v("p-button")]),e._v(" tag to the DOM.")])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-html"},[e._v("<p-button>Hello</p-button>\n")])])},function(){var e=this,t=e._self._c;return t("p",[e._v('For now, this is just a "dead" html tag without any appearance or functionality. You can\'t see it because it is hidden via CSS by the mandatory '),t("a",{attrs:{href:"partials/initial-styles"}},[e._v("getInitialStyles()")]),e._v(" partial which outputs something like")])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-html"},[e._v("p-button { visibility: hidden; }\n.hydrated { visibility: inherit; }\n")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("The "),t("strong",[e._v("core chunk")]),e._v(" detects the newly added tag and knows from its checklist that this component was not used and loaded before. So it loads the "),t("strong",[e._v("component chunk")]),e._v(", e.g. "),t("code",[e._v("porsche-design-system.button.d471231621db4170e79a.js")]),e._v(".")])},function(){var e=this,t=e._self._c;return t("p",[e._v("Once the "),t("strong",[e._v("component chunk")]),e._v(" is loaded, the component gets initialized.")])},function(){var e=this,t=e._self._c;return t("p",[e._v("Initialization of a component tag means that under the hood, an instance of the "),t("code",[e._v("Button")]),e._v(" class is created in the JavaScript space.")])},function(){var e=this,t=e._self._c;return t("p",[e._v("Once the class instance is constructed by executing its "),t("code",[e._v("constructor()")]),e._v(" the following lifecycle methods are executed in order:")])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[t("code",[e._v("connectedCallback()")])]),t("li",[t("code",[e._v("componentWillLoad()")])]),t("li",[t("code",[e._v("componentWillRender()")])]),t("li",[t("code",[e._v("render()")])]),t("li",[t("code",[e._v("componentDidRender()")])]),t("li",[t("code",[e._v("componentDidLoad()")])])])},function(){var e=this,t=e._self._c;return t("p",[e._v("Different lifecycles can be used for validation, child or parent synchronisation, de-/registering event listeners, layout calculations and many other things. But most importantly to render the actual component itself. Additional information can be found in the official documentation for "),t("a",{attrs:{href:"https://stenciljs.com/docs/component-lifecycle"}},[e._v("Stencil Component Lifecycle Methods")]),e._v(".")])},function(){var e=this,t=e._self._c;return t("p",[e._v("Once this process is complete, the "),t("code",[e._v("hyrated")]),e._v(" CSS class gets added to the component tag.")])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-html"},[e._v('<p-button class="hydrated">Hello</p-button>\n')])])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[t("code",[e._v("@Watch('propName')")])]),t("li",[t("code",[e._v("componentShouldUpdate()")])]),t("li",[t("code",[e._v("componentWillUpdate()")])]),t("li",[t("code",[e._v("componentWillRender()")])]),t("li",[t("code",[e._v("render()")])]),t("li",[t("code",[e._v("componentDidRender()")])]),t("li",[t("code",[e._v("componentDidUpdate()")])])])},function(){var e=this,t=e._self._c;return t("p",[e._v("If the "),t("code",[e._v("p-button")]),e._v(" is removed from the DOM, only one lifecycle method of the class instance is invoked.")])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[t("code",[e._v("disconnectedCallback()")])])])},function(){var e=this,t=e._self._c;return t("p",[e._v("In case the same "),t("code",[e._v("p-button")]),e._v(" element is added to the DOM again, just one lifecycle method is called.")])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[t("code",[e._v("connectedCallback()")])])])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-js"},[e._v("const el = document.querySelector('p-button');\nel.remove();\n\nsetTimeout(() => document.body.append(el), 1000);\n")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("Now that it is clear what is happening under the hood when a simple "),t("code",[e._v("p-button")]),e._v(" is added to the DOM, let's see how this looks from the perspective of network requests and how to improve them if necessary.")])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("0840"),alt:"Loading Behavior Vanilla Js 01"}})])},function(){var e=this,t=e._self._c;return t("ul",[t("li",[e._v("starts with the "),t("code",[e._v("index.html")])]),t("li",[e._v("then continues with the "),t("code",[e._v("index.js")]),e._v(" of "),t("code",[e._v("@porsche-design-system/components-js")])]),t("li",[e._v("which then loads the "),t("strong",[e._v("core chunk")])]),t("li",[e._v("that injects both the "),t("strong",[e._v("font-face.css")]),e._v(" and the "),t("strong",[e._v("component chunk")])]),t("li",[e._v("and last the "),t("strong",[e._v("font file")]),e._v(" after the styles within the component's Shadow DOM are applied")])])},function(){var e=this,t=e._self._c;return t("p",[e._v("By applying the "),t("a",{attrs:{href:"partials/font-face-stylesheet"}},[e._v("getFontFaceStylesheet()")]),e._v(" partial we can preload the "),t("strong",[e._v("font-face.css")]),e._v(" asset.")])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("6229"),alt:"Loading Behavior Vanilla Js 02"}})])},function(){var e=this,t=e._self._c;return t("p",[e._v("As we can see, this happens in parallel with the "),t("code",[e._v("index.js")]),e._v(" file.")])},function(){var e=this,t=e._self._c;return t("p",[e._v("By applying the "),t("a",{attrs:{href:"partials/font-links"}},[e._v("getFontLinks()")]),e._v(" partial we can preload the font assets. As a default, both "),t("code",[e._v("regular")]),e._v(" and "),t("code",[e._v("semi-bold")]),e._v(" weights are preloaded since they are most commonly used but this can be customized.")])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("c4bb"),alt:"Loading Behavior Vanilla Js 03"}})])},function(){var e=this,t=e._self._c;return t("p",[e._v("As a result, both font files are additionally loaded in parallel, while earlier this happened not only in sequence but even last and only when a style is present on the page that uses the "),t("code",[e._v("font-family")]),e._v(" and that particular "),t("code",[e._v("font-weight")]),e._v(" which can lead to a phenomena called "),t("strong",[e._v("Flash of Unstyled Text (FOUT)")]),e._v(".")])},function(){var e=this,t=e._self._c;return t("p",[e._v("The loading experience can be improved further by using the "),t("a",{attrs:{href:"partials/component-chunk-links"}},[e._v("getComponentChunkLinks()")]),e._v(" partial. Without any configuration it simply preloads the "),t("strong",[e._v("core chunk")]),e._v(".")])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("d004"),alt:"Loading Behavior Vanilla Js 04"}})])},function(){var e=this,t=e._self._c;return t("p",[e._v("For the next step, we also want to preload the "),t("strong",[e._v("component chunk")]),e._v(" by using the partial like")])},function(){var e=this,t=e._self._c;return t("pre",[t("code",{staticClass:"language-ts"},[e._v("getComponentChunkLinks({ components: ['button'] });\n")])])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("7e1e"),alt:"Loading Behavior Vanilla Js 05"}})])},function(){var e=this,t=e._self._c;return t("p",[e._v("There is one more improvement we can do, and that is to skip loading the "),t("code",[e._v("index.js")]),e._v(" file of "),t("code",[e._v("@porsche-design-system/components-js")]),e._v(". That can be achieved by using the "),t("a",{attrs:{href:"partials/loader-script"}},[e._v("getLoaderScript()")]),e._v(" partial which essentially produces a "),t("code",[e._v("script")]),e._v(" with the code necessary to load the "),t("strong",[e._v("core chunk")]),e._v(" and it also takes care of calling "),t("code",[e._v("porscheDesignSystem.load()")]),e._v(" so that the manual part from the initial setup is superfluous.")])},function(){var e=this,t=e._self._c;return t("p",[t("img",{attrs:{src:n("b224"),alt:"Loading Behavior Vanilla Js 06"}})])},function(){var e=this,t=e._self._c;return t("p",[e._v("Therefore, the total amount of data transferred is basically the same but without the additional request and the necessary http communication, like request and response headers. Also "),t("a",{attrs:{href:"developing/components-ready"}},[e._v("componentsReady()")]),e._v(" isn't part of "),t("code",[e._v("getLoaderScript()")]),e._v(".")])}],i=n("2877"),s={},r=Object(i["a"])(s,o,a,!1,null,null,null);t["default"]=r.exports},6229:function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-02.d3e3d493.jpg"},"7e1e":function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-05.2c8082fd.jpg"},b224:function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-06.540db606.jpg"},c4bb:function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-03.3e41bfb3.jpg"},d004:function(e,t,n){e.exports=n.p+"img/loading-behavior-vanilla-js-04.8b7055a8.jpg"}}]);
//# sourceMappingURL=chunk-cd45cb70.046d4a95.js.map