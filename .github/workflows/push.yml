on:
  push:
    branches:
      - main
      - v*
      - issue/*
      - housekeeping/*
      - release/*
name: 'Porsche Design System'
env:
  PDS_NODE_DOCKER_IMAGE: ghcr.io/porsche-design-system/porsche-design-system/node:16.15.1-stretch-slim
  PDS_PLAYWRIGHT_DOCKER_IMAGE: ghcr.io/porsche-design-system/porsche-design-system/playwright:v1.27.0-focal
jobs:
  components-unit:
    name: 'Components Unit'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
        shell: bash
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Lint'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-lint
          args: --components
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components
  components-js-unit:
    name: 'Components JS Unit'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Unit Test Components Manager Core'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-js:components-manager-core
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-prod
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js-prod
      - name: 'Unit Test Components Wrapper'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-js:components-wrapper
      - name: 'Unit Test Partials'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-js:partials
      - name: 'Unit Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-js-unit-regression
          path: ./packages/components-js/tests/unit/results
  components-js-e2e-puppeteer:
    name: 'Components JS E2E (Puppeteer)'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'E2E Test (Puppeteer)'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-e2e-puppeteer
          args: --components-js
  components-js-e2e-playwright:
    name: 'Components JS E2E (Playwright)'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'E2E Test (Playwright)'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-e2e-playwright
          args: --components-js
  components-js-vrt-puppeteer:
    name: 'Components JS VRT (Puppeteer)'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'VRT Test (Puppeteer)'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt-puppeteer
          args: --components-js
      - name: 'VRT Regression (Puppeteer)'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-js-vrt-puppeteer-regression
          path: ./packages/components-js/tests/vrt/puppeteer/results
  components-js-vrt-playwright:
    name: 'Components JS VRT (Playwright)'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'VRT Test (Playwright)'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt-playwright
          args: --components-js
      - name: 'VRT Regression (Playwright)'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-js-vrt-playwright-regression
          path: ./packages/components-js/tests/vrt/playwright/results
  components-angular:
    name: 'Components Angular'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-angular
      - name: 'Build Components Angular'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-angular
      - name: 'E2E Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-e2e
          args: --components-angular
      - name: 'VRT Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --components-angular
      - name: 'VRT Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-angular-vrt-regression
          path: ./packages/components-angular/tests/vrt/results
  components-react:
    name: 'Components React'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'Unit Test react-wrapper'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-react:react-wrapper
      - name: 'Unit Test uxpin-wrapper'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-react:uxpin-wrapper
      - name: 'Unit Test jsdom-polyfill'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-react:jsdom-polyfill
      - name: 'E2E Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-e2e
          args: --components-react
      - name: 'VRT Test components-react'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --components-react
      - name: 'VRT Regression components-react'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-react-vrt-regression
          path: ./packages/components-react/tests/vrt/results
  components-react-nextjs:
    name: 'Components React NextJS'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'VRT Test components-react/nextjs'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --components-react/nextjs
      - name: 'Unit Test react-ssr-wrapper'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --components-react:react-ssr-wrapper
      - name: 'VRT Regression components-react/nextjs'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: components-react-nextjs-vrt-regression
          path: ./packages/components-react/projects/nextjs/tests/vrt/results
  components-vue:
    name: 'Components Vue'
    runs-on: ubuntu-latest
    steps:
    - name: 'Checkout'
      uses: actions/checkout@v3
    - name: 'Cache node_modules'
      uses: actions/cache@v3
      id: cache-node_modules
      with:
        path: '**/node_modules'
        key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
    - name: 'Login to GitHub Container Registry'
      uses: docker/login-action@v2
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    - name: 'Pull Docker Image'
      run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
    - name: 'Install'
      if: steps.cache-node_modules.outputs.cache-hit != 'true'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-install
    - name: 'Build Core Dependencies'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-build
        args: --core-dependencies
    - name: 'Build Components'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-build
        args: --components
    - name: 'Build Components JS'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-build
        args: --components-js
    - name: 'Lint'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-lint
        args: --components-vue
    - name: 'Build Components Vue'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-build
        args: --components-vuee
#    - name: 'Unit Test vue-wrapper'
#      uses: ./.github/actions/docker-run-playwright
#      with:
#        entrypoint: run-test-unit
#        args: --components-vue
#    - name: 'E2E Test components-vue'
#      uses: ./.github/actions/docker-run-playwright
#      with:
#        entrypoint: run-test-e2e
#        args: --components-vue
    - name: 'VRT Test components-vue'
      uses: ./.github/actions/docker-run-playwright
      with:
        entrypoint: run-test-vrt
        args: --components-vue
    - name: 'VRT Regression components-vue'
      if: failure()
      uses: actions/upload-artifact@v3
      with:
        name: components-vue-vrt-regression
        path: ./packages/components-vuee/tests/vrt/results
  fallbacks:
    name: 'Fallbacks'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Shared'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --shared
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --fallbacks
      - name: 'VRT Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --fallbacks
      - name: 'VRT Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: fallbacks-vrt-regression
          path: ./packages/fallbacks/tests/vrt/results
  shared:
    name: 'Shared'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Shared'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --shared
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --shared
  storefront-unit:
    name: 'Storefront Unit'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components Angular'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-angular
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'Lint'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-lint
          args: --storefront
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --storefront
  storefront-e2e:
    name: 'Storefront E2E'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components Angular'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-angular
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'E2E Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-e2e
          args: --storefront
      - name: 'E2E Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: storefront-e2e-regression
          path: ./packages/storefront/tests/e2e/results
  storefront-a11y:
    name: 'Storefront a11y'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components Angular'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-angular
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'a11y Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-a11y
          args: --storefront
      - name: 'a11y Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: storefront-a11y-regression
          path: ./packages/storefront/tests/e2e/results
  storefront-vrt:
    name: 'Storefront VRT'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Build Components'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components
      - name: 'Build Components JS'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-js
      - name: 'Build Components Angular'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-angular
      - name: 'Build Components React'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --components-react
      - name: 'VRT Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --storefront
      - name: 'VRT Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: storefront-vrt-regression
          path: ./packages/storefront/tests/vrt/results
  production-builds:
    name: 'Production Builds'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --core-dependencies
      - name: 'Build Components Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --components
      - name: 'Build Components JS Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --components-js
      - name: 'Build Components Angular Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --components-angular
      - name: 'Build Components React Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --components-react
      - name: 'Build Components Vue Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --components-vue
      - name: 'Build Storefront Prod'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build-prod
          args: --storefront
      - name: 'Store Assets CDN Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: assets-cdn
          path: ./packages/assets/cdn
      - name: 'Store Assets Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: assets-build
          path: ./packages/assets/dist
      - name: 'Store Components JS Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-js-prod-build
          path: ./packages/components-js/dist
      - name: 'Store Components Angular Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-angular-prod-build
          path: ./packages/components-angular/dist/angular-wrapper
      - name: 'Store Components React Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-react-prod-build
          path: ./packages/components-react/dist/react-wrapper
      - name: 'Store Components UXPin Source Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-uxpin-source
          path: ./packages/components-react/projects/uxpin-wrapper # upload entire folder to have all generated files including uxpin.config.js
      - name: 'Store Components Vue Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-vue-prod-build
          path: ./packages/components-vue/dist/vue-wrapper
      - name: 'Store Chunks Manifest Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: components-js-chunks-manifest-prod-build
          path: ./packages/components-js/projects/components-wrapper/lib
      - name: 'Store Shared Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: shared-build
          path: ./packages/shared/dist
      - name: 'Store Storefront Build Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: storefront-build
          path: ./packages/storefront/dist
      - name: 'Store Utilities Artifact'
        uses: actions/upload-artifact@v3
        with:
          name: utilities-deprecated-full-build
          path: ./packages/utilities-deprecated/projects/utilities # We have to provide the full directory to avoid nested directory in npm package (scss.scss in package directory)
  utilities:
    name: 'Utilities'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --utilities
  utilities-deprecated:
    name: 'Utilities Deprecated'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Build Core Dependencies'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-build
          args: --core-dependencies
      - name: 'Unit Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-unit
          args: --utilities-deprecated
      - name: 'VRT Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-vrt
          args: --utilities-deprecated
      - name: 'VRT Regression'
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: utilities-deprecated-vrt-regression
          path: ./packages/utilities-deprecated/tests/vrt/results
  assets-deployment:
    name: 'Assets Deployment'
    needs:
      - production-builds
      - components-unit
      - components-js-unit
      - components-js-e2e-puppeteer
      - components-js-e2e-playwright
      - components-js-vrt-puppeteer
      - components-js-vrt-playwright
      - components-angular
      - components-react
      - components-react-nextjs
      - components-vue
      - fallbacks
      - shared
      - storefront-unit
      - storefront-e2e
      - storefront-a11y
      - storefront-vrt
      - utilities
      - utilities-deprecated
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Assets Artifact'
        uses: actions/download-artifact@v3
        with:
          name: assets-cdn
          path: ./packages/assets/cdn
      - name: 'Deploy Assets to CDN'
        uses: ./.github/actions/docker-run-playwright
        env:
          CDN_USER: ${{ secrets.CDN_USER }}
          CDN_SSH_KEY: ${{ secrets.CDN_SSH_KEY }}
        with:
          entrypoint: run-deploy-assets
  storefront-deployment:
    name: 'Storefront Deployment'
    needs:
      - production-builds
      - components-unit
      - components-js-unit
      - components-js-e2e-puppeteer
      - components-js-e2e-playwright
      - components-js-vrt-puppeteer
      - components-js-vrt-playwright
      - components-angular
      - components-react
      - components-react-nextjs
      - components-vue
      - fallbacks
      - shared
      - storefront-unit
      - storefront-e2e
      - storefront-a11y
      - storefront-vrt
      - utilities
      - utilities-deprecated
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Install' # needed for algolia
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-install
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: storefront-build
          path: ./packages/storefront/dist
      - name: 'Deploy'
        uses: ./.github/actions/docker-run-playwright
        env:
          ALGOLIA_APP_ID: ${{ secrets.ALGOLIA_APP_ID }}
          ALGOLIA_API_KEY: ${{ secrets.ALGOLIA_API_KEY }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        with:
          entrypoint: run-deploy-storefront
  smoke-test:
    name: 'Smoke Test'
    needs:
      - assets-deployment
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Assets Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: assets-build
          path: ./packages/assets/dist
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-js-prod-build
          path: ./packages/components-js/dist
      - name: 'Restore Chunks Manifest Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-js-chunks-manifest-prod-build
          path: ./packages/components-js/projects/components-wrapper/lib
      - name: 'Restore Shared Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: shared-build
          path: ./packages/shared/dist
      - name: 'Smoke Test'
        uses: ./.github/actions/docker-run-playwright
        with:
          entrypoint: run-test-smoke
          args: --components-js
  release-components-uxpin:
    name: 'Release Components UXPin'
    needs:
      - assets-deployment
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
        with:
          fetch-depth: 0 # important for uxpin since it uses the commit history
      - name: 'Cache node_modules'
        uses: actions/cache@v3
        id: cache-node_modules
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-${{ hashFiles('**/yarn.lock') }}
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_NODE_DOCKER_IMAGE }}
      - name: 'Install'
        if: steps.cache-node_modules.outputs.cache-hit != 'true'
        uses: ./.github/actions/docker-run-node
        with:
          entrypoint: run-install
      - name: 'Restore Components JS Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-js-prod-build
          path: ./packages/components-js/dist
      - name: 'Restore Components UXPin Source Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-uxpin-source
          path: ./packages/components-react/projects/uxpin-wrapper
      - name: 'Publish UXPin Library'
        uses: ./.github/actions/docker-run-node
        env:
          UXPIN_TOKEN_DEV: ${{ secrets.UXPIN_TOKEN_DEV }}
          UXPIN_TOKEN_LATEST: ${{ secrets.UXPIN_TOKEN_LATEST }}
        with:
          entrypoint: run-release-uxpin
  release-components-js:
    name: 'Release Components JS'
    needs:
      - smoke-test
      - storefront-deployment
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-js-prod-build
          path: ./packages/components-js/dist
      - name: 'Publish NPM Package'
        uses: ./.github/actions/docker-run-playwright
        env:
          PORSCHE_NPM_REGISTRY_TOKEN: ${{ secrets.PORSCHE_NPM_REGISTRY_TOKEN }}
          NPMJS_REGISTRY_TOKEN: ${{ secrets.NPMJS_REGISTRY_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-npm
          args: packages/components-js/dist/components-wrapper
  release-components-angular:
    name: 'Release Components Angular'
    needs:
      - release-components-js
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-angular-prod-build
          path: ./packages/components-angular/dist/angular-wrapper
      - name: 'Publish NPM Package'
        uses: ./.github/actions/docker-run-playwright
        env:
          PORSCHE_NPM_REGISTRY_TOKEN: ${{ secrets.PORSCHE_NPM_REGISTRY_TOKEN }}
          NPMJS_REGISTRY_TOKEN: ${{ secrets.NPMJS_REGISTRY_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-npm
          args: packages/components-angular/dist/angular-wrapper
  release-components-react:
    name: 'Release Components React'
    needs:
      - release-components-js
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: components-react-prod-build
          path: ./packages/components-react/dist/react-wrapper
      - name: 'Publish NPM Package'
        uses: ./.github/actions/docker-run-playwright
        env:
          PORSCHE_NPM_REGISTRY_TOKEN: ${{ secrets.PORSCHE_NPM_REGISTRY_TOKEN }}
          NPMJS_REGISTRY_TOKEN: ${{ secrets.NPMJS_REGISTRY_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-npm
          args: packages/components-react/dist/react-wrapper
  # TODO: release-components-vue
  release-assets:
    name: 'Release Assets'
    needs:
      - smoke-test
      - storefront-deployment
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Build Artifact'
        uses: actions/download-artifact@v3
        with:
          name: assets-build
          path: ./packages/assets/dist
      - name: 'Publish NPM Package'
        uses: ./.github/actions/docker-run-playwright
        env:
          PORSCHE_NPM_REGISTRY_TOKEN: ${{ secrets.PORSCHE_NPM_REGISTRY_TOKEN }}
          NPMJS_REGISTRY_TOKEN: ${{ secrets.NPMJS_REGISTRY_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-npm
          args: packages/assets/dist
  release-utilities-deprecated:
    name: 'Release Utilities Deprecated'
    needs:
      - smoke-test
      - storefront-deployment
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Restore Utilities Deprecated Artifact'
        uses: actions/download-artifact@v3
        with:
          name: utilities-deprecated-full-build
          path: ./packages/utilities-deprecated/projects/utilities # See store artifact comment -> full directory and build of utilities
      - name: 'Publish NPM Package'
        uses: ./.github/actions/docker-run-playwright
        env:
          PORSCHE_NPM_REGISTRY_TOKEN: ${{ secrets.PORSCHE_NPM_REGISTRY_TOKEN }}
          NPMJS_REGISTRY_TOKEN: ${{ secrets.NPMJS_REGISTRY_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-npm
          args: packages/utilities-deprecated/projects/utilities
  release-sketch-libraries:
    name: 'Release Sketch Libraries'
    needs:
      - smoke-test
      - storefront-deployment
    if: startsWith( github.ref, 'refs/heads/v') || github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout'
        uses: actions/checkout@v3
      - name: 'Login to GitHub Container Registry'
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - name: 'Pull Docker Image'
        run: docker pull ${{ env.PDS_PLAYWRIGHT_DOCKER_IMAGE }}
      - name: 'Publish Sketch Library Basic'
        uses: ./.github/actions/docker-run-playwright
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-sketch
          args: sketch/basic
      - name: 'Publish Sketch Library Web'
        uses: ./.github/actions/docker-run-playwright
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          entrypoint: run-release-sketch
          args: sketch/web
