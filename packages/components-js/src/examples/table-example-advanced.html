<p-table></p-table>

<script>
  fetch('assets/shared.js')
    .then((res) => res.text())
    .then((content) => {
      const [, headStr] = /const headAdvanced = ((.|\s)*?);/.exec(content) || [];
      const head = eval(headStr);

      const [, dataStr] = /const dataAdvanced = ((.|\s)*?);/.exec(content) || [];
      const data = eval(dataStr);

      const renderTableHeadCells = (items) =>
        items.map((item) => `<p-table-head-cell>${item.name || ''}</p-table-head-cell>`).join('');

      const renderTableBodyRows = (items) =>
        items
          .map(
            (item) => `
<p-table-row>
  <p-table-cell>
    <p-flex>
      <p-flex-item>
        <img src="${item.imageUrl}" width="80" style="margin-right: 8px" alt="" />
      </p-flex-item>
      <p-flex-item>
        <p-text weight='semibold'>${item.model}</p-text>
        <p-text size='x-small'>${item.date}</p-text>
      </p-flex-item>
    </p-flex>
  </p-table-cell>
  <p-table-cell>${item.interest}</p-table-cell>
  <p-table-cell>${item.vin}</p-table-cell>
  <p-table-cell>${item.purchaseIntention}</p-table-cell>
  <p-table-cell>${item.status}</p-table-cell>
  <p-table-cell>${item.leadId}</p-table-cell>
  <p-table-cell>
    <p-button-pure icon="edit" style="padding: .5rem">Edit Lead</p-button-pure>
  </p-table-cell>
</p-table-row>`
          )
          .join('');

      const markup = `
<p-table-head>
  <p-table-head-row>${renderTableHeadCells(head)}</p-table-head-row>
</p-table-head>
<p-table-body>${renderTableBodyRows(data)}</p-table-body>`;

      const table = document.querySelector('p-table');
      table.innerHTML = markup;
      const tableHead = table.querySelector('p-table-head');
      const tableBody = table.querySelector('p-table-body');

      // pass head item via property
      const passHeadItemToNodes = (items) =>
        Array.from(tableHead.querySelectorAll('p-table-head-cell')).forEach((el, index) => {
          el.hideLabel = items.hideLabel;
          el.sort = items[index];
        });

      passHeadItemToNodes(head);

      table.addEventListener('sortingChange', (e) => {
        const { id, direction } = e.detail;

        const sortedHead = head.map((x) => ({ ...x, active: false, ...(x.id === id && e.detail) }));
        const sortedData = [...data].sort((a, b) =>
          direction === 'asc' ? a[id].localeCompare(b[id]) : b[id].localeCompare(a[id])
        );

        passHeadItemToNodes(sortedHead);
        tableBody.innerHTML = renderTableBodyRows(sortedData);
      });
    });
</script>
