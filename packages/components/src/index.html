<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Porsche Design System - Playground</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script nomodule src="build/porsche-design-system.js"></script>
    <script type="module" src="build/porsche-design-system.esm.js"></script>
    <style>
      a {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        text-indent: -9999px;
      }

      a:hover {
        background: #ff14937d;
      }

      p-button,
      p-button-pure {
        position: relative;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div class="playground"></div>

    <!-- START: keep this snippet to log component lifecycle events -->
    <script>
      const widths = [200, 80, 80, 100, 80, 100, 100, 122];

      const head = [
        { name: 'Model' },
        { name: 'Interest', key: 'interest' },
        { name: 'VIN', key: 'vin' },
        { name: 'Purchase Intention', key: 'purchaseIntention' },
        { name: 'Status', key: 'status' },
        { name: 'Lead ID', key: 'leadId' },
        { name: '' },
        { name: '' },
      ].map((item, i) => ({
        ...item,
        ...(item.name && {
          isSortable: i > 0,
          isSorting: i === 1,
          direction: 'asc',
        }),
      }));

      const data = [
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '08.2020',
          status: 'Won',
          leadId: '0000824402',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/taycan.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '11.2020',
          status: 'Lost',
          leadId: '0000824409',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '09.2020',
          status: 'Won but then canceled again',
          leadId: '0000824408',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/718.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '04.2020',
          status: 'Lost',
          leadId: '0000824407',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '03.2020',
          status: 'Won',
          leadId: '0000824406',
        },
      ];

      const renderTableHeadCells = (items) =>
        items
          .map((item, i) => `<p-table-head-cell style="width: ${widths[i]}px">${item.name}</p-table-head-cell>`)
          .join('');

      const renderTableBodyRows = (items) =>
        items
          .map(
            (item) => `
<p-table-row>
  <p-table-cell style="width: ${widths[0]}px">
    <p-flex>
      <p-flex-item>
        <img src="${item.imageUrl}" width="80" style="margin-right: 8px" alt="">
      </p-flex-item>
      <p-flex-item>
        <p-text weight='semibold'>${item.model}</p-text>
        <p-text size='x-small'>${item.date}</p-text>
      </p-flex-item>
    </p-flex>
  </p-table-cell>
  <p-table-cell style="width: ${widths[1]}px">${item.interest}</p-table-cell>
  <p-table-cell style="width: ${widths[2]}px">${item.vin}</p-table-cell>
  <p-table-cell style="width: ${widths[3]}px">${item.purchaseIntention}</p-table-cell>
  <p-table-cell style="width: ${widths[4]}px">${item.status}</p-table-cell>
  <p-table-cell style="width: ${widths[5]}px">${item.leadId}</p-table-cell>
  <p-table-cell style="width: ${widths[6]}px">
    <p-button-pure icon="edit">
      <span style="white-space: nowrap">Edit Lead</span>
    </p-button-pure>
  </p-table-cell>
  <p-table-cell style="width: ${widths[7]}px">
    <p-button variant="tertiary" icon="refresh">
      <span style="white-space: nowrap">Overwrite</span>
    </p-button>
    <a href='#${item.leadId}'>Open Detail</a>
  </p-table-cell>
</p-table-row>`
          )
          .join('');

      const markup = `
<p-table>
  <p-table-head>
    <p-table-row>${renderTableHeadCells(head)}</p-table-row>
  </p-table-head>
  <p-table-body>${renderTableBodyRows(data)}</p-table-body>
</p-table>`;

      const playground = document.querySelector('.playground');
      playground.innerHTML = markup;

      const table = document.querySelector('p-table');
      const tableHead = document.querySelector('p-table-head');
      const tableBody = document.querySelector('p-table-body');

      // pass head item via property
      const passHeadItemToNodes = (items) =>
        Array.from(tableHead.querySelectorAll('p-table-head-cell')).forEach((el, index) => {
          el.item = items[index];
        });

      passHeadItemToNodes(head);

      // table.query = 'Ma';
      table.addEventListener('sortingChange', (e) => {
        console.log('sortingChange', e.detail);
        const { key, direction } = e.detail;

        const sortedHead = head.map((x) => ({ ...x, isSorting: false, ...(x.key === key && e.detail) }));
        const sortedData = [...data].sort((a, b) =>
          direction === 'asc' ? a[key].localeCompare(b[key]) : b[key].localeCompare(a[key])
        );

        passHeadItemToNodes(sortedHead);
        tableBody.innerHTML = renderTableBodyRows(sortedData);
      });

      ['componentWillLoad', 'componentDidLoad', 'componentWillUpdate', 'componentDidUpdate'].forEach((x) =>
        window.addEventListener(`stencil_${x}`, (e) => {
          const eventName = e.type + (e.type.includes('Did') ? ' ' : '');
          console.log(eventName, e.composedPath()[0].tagName.toLowerCase(), new Date().toISOString());
        })
      );
    </script>
    <!-- /END -->
  </body>
</html>
