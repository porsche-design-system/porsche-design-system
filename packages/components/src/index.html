<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Porsche Design System - Playground</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script nomodule src="build/porsche-design-system.js"></script>
    <script type="module" src="build/porsche-design-system.esm.js"></script>
  </head>
  <body>
    <div class="playground"></div>

    <!-- START: keep this snippet to log component lifecycle events -->
    <script>
      const head = [
        { name: 'Model' },
        { name: 'Interest', key: 'interest' },
        { name: 'VIN', key: 'vin' },
        { name: 'Purchase Intention', key: 'purchaseIntention' },
        { name: 'Status', key: 'status' },
        { name: 'Lead ID', key: 'leadId' },
        { name: 'Actions' },
      ].map((item, i) => ({
        ...item,
        ...(item.name && {
          isSortable: i > 0 && i !== 6,
          isSorting: i === 1,
          direction: 'asc',
        }),
      }));

      const data = [
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '08.2020',
          status: 'Won',
          leadId: '0000824402',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/taycan.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '11.2020',
          status: 'Lost',
          leadId: '0000824409',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '09.2020',
          status: 'Won but then canceled again',
          leadId: '0000824408',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/718.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '04.2020',
          status: 'Lost',
          leadId: '0000824407',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '03.2020',
          status: 'Won',
          leadId: '0000824406',
        },
      ];

      const renderTableHeadCells = (items) =>
        items
          .map((item, i) => {return `<p-table-head-cell ${i === 6 ? 'hide-label': ''}>${i === 4 ? item.name +'<br>with a subline' : item.name}</p-table-head-cell>`})
          .join('');

      const renderTableBodyRows = (items) =>
        items
          .map(
            (item) => `
<p-table-row>
  <p-table-cell>
    <p-flex>
      <p-flex-item>
        <img src="${item.imageUrl}" width="80" height="48" style="margin-right: .5rem" alt="Some image description.">
      </p-flex-item>
      <p-flex-item>
        <p-text weight="semibold"><a href="#">${item.model}</a></p-text>
        <p-text size="x-small">${item.date}</p-text>
      </p-flex-item>
    </p-flex>
  </p-table-cell>
  <p-table-cell>
    <b>${item.interest}</b>
  </p-table-cell>
  <p-table-cell>${item.vin}</p-table-cell>
  <p-table-cell>${item.purchaseIntention}</p-table-cell>
  <p-table-cell>${item.status}</p-table-cell>
  <p-table-cell>${item.leadId}</p-table-cell>
  <p-table-cell>
      <p-link-pure style="padding: .5rem;" href="#" icon="edit">Edit</p-link-pure>
      <p-link-pure style="padding: .5rem;" href="#" icon="delete">Delete</p-link-pure>
  </p-table-cell>
</p-table-row>`
          )
          .join('');

      const markup = `
<br><br>
<p-table caption="Porsche Data Table">
  <p-table-head>
    <p-table-head-row>${renderTableHeadCells(head)}</p-table-head-row>
  </p-table-head>
  <p-table-body>${renderTableBodyRows(data)}</p-table-body>
</p-table>`;

      const playground = document.querySelector('.playground');
      playground.innerHTML = markup;

      const table = document.querySelector('p-table');
      const tableHead = document.querySelector('p-table-head');
      const tableBody = document.querySelector('p-table-body');

      // pass head item via property
      const passHeadItemToNodes = (items) =>
        Array.from(tableHead.querySelectorAll('p-table-head-cell')).forEach((el, index) => {
          el.item = items[index];
        });

      passHeadItemToNodes(head);

      // table.query = 'Ma';
      table.addEventListener('sortingChange', (e) => {
        console.log('sortingChange', e.detail);
        const { key, direction } = e.detail;

        const sortedHead = head.map((x) => ({ ...x, isSorting: false, ...(x.key === key && e.detail) }));
        const sortedData = [...data].sort((a, b) =>
          direction === 'asc' ? a[key].localeCompare(b[key]) : b[key].localeCompare(a[key])
        );

        passHeadItemToNodes(sortedHead);
        tableBody.innerHTML = renderTableBodyRows(sortedData);
      });

      ['componentWillLoad', 'componentDidLoad', 'componentWillUpdate', 'componentDidUpdate'].forEach((x) =>
        window.addEventListener(`stencil_${x}`, (e) => {
          const eventName = e.type + (e.type.includes('Did') ? ' ' : '');
          console.log(eventName, e.composedPath()[0].tagName.toLowerCase(), new Date().toISOString());
        })
      );
    </script>
    <br>
    <br>
    <br>
    <br>
    <div style="height: 2000px; background: radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%);"></div>
    <!-- /END -->
  </body>
</html>
