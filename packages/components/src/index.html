<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Porsche Design System - Playground</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script nomodule src="build/porsche-design-system.js"></script>
    <script type="module" src="build/porsche-design-system.esm.js"></script>
  </head>
  <body>
    <p-table caption="Some caption"></p-table>

    <p-tabs-bar active-tab-index="0">
      <button type="button" id="tab-item-0" aria-controls="tab-panel-0">Tab One</button>
      <button type="button" id="tab-item-1" aria-controls="tab-panel-1">Tab Two</button>
      <button type="button" id="tab-item-2" aria-controls="tab-panel-2">Tab Three</button>
    </p-tabs-bar>

    <div id="tab-panel-0" role="tabpanel" tabindex="0" aria-labelledby="tab-item-0">
      <p-text>Your content of Tab 1</p-text>
    </div>
    <div id="tab-panel-1" role="tabpanel" hidden tabindex="-1" aria-labelledby="tab-item-1">
      <p-text>Your content of Tab 2</p-text>
    </div>
    <div id="tab-panel-2" role="tabpanel" hidden tabindex="-1" aria-labelledby="tab-item-2">
      <p-text>Your content of Tab 3</p-text>
    </div>
    <!-- START: keep this snippet to log component lifecycle events -->
    <script>
      ['componentWillLoad', 'componentDidLoad', 'componentWillUpdate', 'componentDidUpdate'].forEach((x) =>
        window.addEventListener(`stencil_${x}`, (e) => {
          const eventName = e.type + (e.type.includes('Did') ? ' ' : '');
          console.log(eventName, e.composedPath()[0].tagName.toLowerCase(), new Date().toISOString());
        })
      );

      const head = [
        { name: 'Column 1', id: 'col1' },
        { name: 'Column 2', id: 'col2' },
        { name: 'Column 3', id: 'col3' },
      ].map((item, i) => ({
        ...item,
        active: i === 1,
        direction: 'asc',
      }));
      const data = [
        {
          col1: 'Name A',
          col2: '9',
          col3: '01.06.2021',
        },
        {
          col1: 'Name Z',
          col2: '1',
          col3: '24.06.2021',
        },
      ];
      (async () => {
        const renderTableHeadRow = (items) =>
          [
            '<p-table-head-row>',
            ...items.map((item) => `<p-table-head-cell>${item.name}</p-table-head-cell>`),
            '</p-table-head-row>',
          ].join('');

        const renderTableBodyRows = (items) =>
          items
            .map(
              (item) => `
                <p-table-row>
                  <p-table-cell>${item.col1}</p-table-cell>
                  <p-table-cell>${item.col2}</p-table-cell>
                  <p-table-cell>${item.col3}</p-table-cell>
                </p-table-row>`
            )
            .join('');

        const markup = `
                <p-table-head>${renderTableHeadRow(head)}</p-table-head>
                <p-table-body>${renderTableBodyRows(data)}</p-table-body>`;

        const table = document.querySelector('p-table');
        table.innerHTML = markup;
        const tableHeadCells = table.querySelectorAll('p-table-head-cell');
        const tableBody = table.querySelector('p-table-body');

        // pass head items via property
        const passHeadItemsToNodes = (items) =>
          tableHeadCells.forEach((el, index) => {
            el.sort = items[index];
          });

        passHeadItemsToNodes(head); // initial state

        table.addEventListener('sortingChange', (e) => {
          const { id, direction } = e.detail;

          const sortedHead = head.map((item) => ({ ...item, active: false, ...(item.id === id && e.detail) }));
          const sortedData = [...data].sort((a, b) =>
            direction === 'asc' ? a[id].localeCompare(b[id]) : b[id].localeCompare(a[id])
          );

          passHeadItemsToNodes(sortedHead);
          tableBody.innerHTML = renderTableBodyRows(sortedData);
        });
      })();

      const panels = Array.from(document.querySelectorAll('[role="tabpanel"]'));

      document.querySelector('p-tabs-bar').addEventListener('tabChange', (e) => {
        e.target.activeTabIndex = e.detail.activeTabIndex;

        panels.forEach((panel, i) => {
          if (i === e.detail.activeTabIndex) {
            panel.removeAttribute('hidden');
            panel.setAttribute('tabindex', '0');
          } else {
            panel.setAttribute('hidden', '');
            panel.setAttribute('tabindex', '-1');
          }
        });
      });
    </script>
    <!-- /END -->
  </body>
</html>
