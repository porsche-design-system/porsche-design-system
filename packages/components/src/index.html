<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Porsche Design System - Playground</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script nomodule src="build/porsche-design-system.js"></script>
    <script type="module" src="build/porsche-design-system.esm.js"></script>
    <style>
      p-headline {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <!--
    <p-headline>table-wrapper</p-headline>
    <p-table-wrapper>
      <table>
        <thead></thead>
        <tbody></tbody>
      </table>
    </p-table-wrapper>
    -->

    <p-headline>table-wrapper-body</p-headline>
    <p-table-wrapper-body></p-table-wrapper-body>

    <!-- START: keep this snippet to log component lifecycle events -->
    <script>
      const head = ['Image', 'First name', 'Last name', 'Company', 'Phone', 'Birthday', 'Location'];
      const data = [
        {
          // id: '202829625',
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          firstName: 'John',
          lastName: 'Locke',
          company: '',
          phoneNumber: '123123121',
          dateOfBirth: '1979-06-12',
          location: 'Boston',
        },
        {
          // id: '202829625',
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/taycan.jpg',
          firstName: 'Matthias',
          lastName: 'Kainer',
          company: 'Company',
          phoneNumber: '',
          dateOfBirth: '1981-06-12',
          location: 'Bretten',
        },
        {
          // id: '202829625',
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          firstName: 'Jason',
          lastName: 'Bourne',
          company: '',
          phoneNumber: '123123121',
          dateOfBirth: '1980-06-12',
          location: 'Berlin',
        },
        {
          // id: '202829625',
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/718.jpg',
          firstName: 'Manni',
          lastName: 'Frisch',
          company: 'Company',
          phoneNumber: '',
          dateOfBirth: '1951-06-12',
          location: 'Hamburg',
        },
        {
          // id: '202829625',
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          firstName: 'Jim',
          lastName: 'Bo',
          company: '',
          phoneNumber: '123123121',
          dateOfBirth: '1975-06-12',
          location: 'Köln',
        },
      ];
      const renderRow = ({ imageUrl, firstName, lastName, company, phoneNumber, dateOfBirth, location }) => `
      <tr>
        <td><a href="#${firstName}"><img src="${imageUrl}" width="80px"></a></td>
        <td><a href="#${firstName}">${firstName}</a></td>
        <td><a href="#${firstName}">${lastName}</a></td>
        <td><a href="#${firstName}">${company}</a></td>
        <td><a href="#${firstName}">${phoneNumber ? `# ${phoneNumber}` : ''}</a></td>
        <td><a href="#${firstName}">† ${dateOfBirth}</a></td>
        <td><a href="#${firstName}">${location}<p-text weight="thin">(Germany)</p-text></a></td>
      </tr>`;

      const tableWrapperBody = document.querySelector('p-table-wrapper-body');

      const dataKeys = Object.keys(data[0]);
      const headSortable = head.map((name, i) => ({
        key: dataKeys[i],
        name,
        isSortable: i > 0,
        isSorting: i === 1,
        direction: 'asc',
      }));

      // const tableHead = document.querySelector('thead');
      // const tableHeadRow = document.createElement('tr');
      // tableHead.append(tableHeadRow);
      // const tableBody = document.querySelector('tbody');

      // head.forEach((item) => {
      //   const el = document.createElement('th');
      //   el.innerText = item;
      //   tableHeadRow.append(el);
      // });

      data.forEach((item) => {
        const el = document.createElement('tr');
        Object.values(item).forEach((x, i) => {
          const elInner = document.createElement('td');
          if (i === 0) {
            const img = document.createElement('img');
            img.src = x;
            elInner.appendChild(img);
          } else {
            elInner.innerText = x;
          }
          el.append(elInner);
        });
        // tableBody.append(el);
        tableWrapperBody.append(el.cloneNode(true));
      });

      // tableWrapperBody.query = 'Ma';
      tableWrapperBody.head = headSortable;
      tableWrapperBody.addEventListener('headClick', (e) => {
        console.log('headClick', e.detail);
        const { key, direction } = e.detail;

        const sortedHead = headSortable.map((x) => ({ ...x, isSorting: false, ...(x.key === key && e.detail) }));

        e.target.head = sortedHead;
        Array.from(e.target.children).forEach((x) => x.remove());

        [...data]
          .sort((a, b) => (direction === 'asc' ? a[key].localeCompare(b[key]) : b[key].localeCompare(a[key])))
          .forEach((item, i) => {
            const el = document.createElement('tr');
            Object.values(item).forEach((x, i) => {
              const elInner = document.createElement('td');
              if (i === 0) {
                const img = document.createElement('img');
                img.src = x;
                elInner.appendChild(img);
              } else {
                elInner.innerText = x;
              }
              el.appendChild(elInner);
            });
            e.target.appendChild(el);
          });
      });

      ['componentWillLoad', 'componentDidLoad', 'componentWillUpdate', 'componentDidUpdate'].forEach((x) =>
        window.addEventListener(`stencil_${x}`, (e) => {
          const eventName = e.type + (e.type.includes('Did') ? ' ' : '');
          console.log(eventName, e.composedPath()[0].tagName.toLowerCase(), new Date().toISOString());
        })
      );
    </script>
    <!-- /END -->
  </body>
</html>
