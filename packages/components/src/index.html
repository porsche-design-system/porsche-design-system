<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Porsche Design System - Playground</title>
    <base href="/" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script nomodule src="build/porsche-design-system.js"></script>
    <script type="module" src="build/porsche-design-system.esm.js"></script>
    <style>
      p-headline {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <p-table>
      <p-table-head></p-table-head>
      <p-table-body></p-table-body>
    </p-table>

    <!-- START: keep this snippet to log component lifecycle events -->
    <script>
      const head = [
        { name: 'Model' },
        { name: 'Interest', key: 'interest' },
        { name: 'VIN', key: 'vin' },
        { name: 'Purchase Intention', key: 'purchaseIntention' },
        { name: 'Status', key: 'status' },
        { name: 'Lead ID', key: 'leadId' },
        { name: '' },
        { name: '' },
      ];
      const data = [
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '08.2020',
          status: 'Won',
          leadId: '0000824402',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/taycan.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '11.2020',
          status: 'Lost',
          leadId: '0000824409',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '09.2020',
          status: 'Won',
          leadId: '0000824408',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/718.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'Used Car',
          vin: '-',
          purchaseIntention: '04.2020',
          status: 'Lost',
          leadId: '0000824407',
        },
        {
          imageUrl: 'https://nav.porsche.com/00BC524/series-assets/1366/911.jpg',
          model: '911 Carrera S',
          date: '03.05.2021',
          interest: 'New Car',
          vin: '-',
          purchaseIntention: '03.2020',
          status: 'Won',
          leadId: '0000824406',
        },
      ];

      const table = document.querySelector('p-table');
      const tableHead = document.querySelector('p-table-head');
      const tableBody = document.querySelector('p-table-body');

      const headSortable = head.map((item, i) => ({
        ...item,
        ...(item.name && {
          isSortable: i > 0,
          isSorting: i === 1,
          direction: 'asc',
        }),
      }));

      const tableHeadRow = document.createElement('p-table-row');
      headSortable.forEach((item) => {
        const el = document.createElement('p-table-cell');
        el.innerText = item.name;
        tableHeadRow.append(el);
      });
      tableHead.appendChild(tableHeadRow);

      const renderRow = (item) => {
        const el = document.createElement('p-table-row');

        const firstTd = document.createElement('p-table-cell');
        const img = document.createElement('img');
        img.src = item.imageUrl;
        img.width = 80;
        img.style.marginRight = '5px';

        const model = document.createElement('p-text');
        model.weight = 'semibold';
        model.innerText = item.model;

        const date = document.createElement('p-text');
        date.size = 'x-small';
        date.innerText = item.date;

        const flex = document.createElement('p-flex');
        const flexItem1 = document.createElement('p-flex-item');
        const flexItem2 = document.createElement('p-flex-item');

        flexItem1.appendChild(img);
        flexItem2.alignSelf = 'center';
        flexItem2.appendChild(model);
        flexItem2.appendChild(date);

        flex.appendChild(flexItem1);
        flex.appendChild(flexItem2);
        firstTd.appendChild(flex);
        el.appendChild(firstTd);

        Object.values(item)
          .slice(3)
          .forEach((x) => {
            const elInner = document.createElement('p-table-cell');
            elInner.innerText = x;
            el.appendChild(elInner);
          });

        const editTd = document.createElement('p-table-cell');
        const editBtn = document.createElement('p-button-pure');
        editBtn.icon = 'edit';
        const editBtnSpan = document.createElement('span');
        editBtnSpan.style.whiteSpace = 'nowrap';
        editBtnSpan.innerText = 'Edit Lead';
        editBtn.appendChild(editBtnSpan);
        editTd.appendChild(editBtn);
        el.appendChild(editTd);

        const ctaTd = document.createElement('p-table-cell');
        const ctaBtn = document.createElement('p-button');
        ctaBtn.variant = 'tertiary';
        ctaBtn.icon = 'refresh';
        const ctaBtnSpan = document.createElement('span');
        ctaBtnSpan.style.whiteSpace = 'nowrap';
        ctaBtnSpan.innerText = 'Overwrite';
        ctaBtn.appendChild(ctaBtnSpan);
        ctaTd.appendChild(ctaBtn);
        el.appendChild(ctaTd);

        return el;
      };

      data.forEach((item) => {
        tableBody.append(renderRow(item));
      });

      // table.query = 'Ma';
      // table.addEventListener('headClick', (e) => {
      //   console.log('headClick', e.detail);
      //   const { key, direction } = e.detail;
      //
      //   const sortedHead = headSortable.map((x) => ({ ...x, isSorting: false, ...(x.key === key && e.detail) }));
      //
      //   e.target.head = sortedHead;
      //   Array.from(e.target.children).forEach((x) => x.remove());
      //
      //   [...data]
      //     .sort((a, b) => (direction === 'asc' ? a[key].localeCompare(b[key]) : b[key].localeCompare(a[key])))
      //     .forEach((item) => {
      //       e.target.appendChild(renderRow(item));
      //     });
      // });

      ['componentWillLoad', 'componentDidLoad', 'componentWillUpdate', 'componentDidUpdate'].forEach((x) =>
        window.addEventListener(`stencil_${x}`, (e) => {
          const eventName = e.type + (e.type.includes('Did') ? ' ' : '');
          console.log(eventName, e.composedPath()[0].tagName.toLowerCase(), new Date().toISOString());
        })
      );
    </script>
    <!-- /END -->
  </body>
</html>
