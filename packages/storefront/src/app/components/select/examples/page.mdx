import { ComponentStatus } from '@/components/components/ComponentStatus';
import { TableOfContents } from '@/components/common/TableOfContents';
import { Configurator } from '@/components/playground/Configurator';
import { selectStoryOptgroups, selectStorySlottedImages, selectStorySlots } from '@/app/components/select/select.stories';
import { ComponentExample } from '@/components/playground/ComponentExample';
import {
  selectExampleForm,
  selectExampleDynamic,
  selectExampleRequired,
  selectExampleAsyncFilter,
  selectExampleSelectedSlot,
} from '@porsche-design-system/shared/examples';
import { ComponentStory } from '@/components/playground/ComponentStory';
import { Notification } from '@/components/common/Notification';

export const metadata = {
  title: 'Select - Porsche Design System',
  description: 'Discover detailed examples and insights of the Select component.',
};

# Select <ComponentStatus tagName="p-select"></ComponentStatus>

<TableOfContents
  headings={[
    'Form',
    'Basic example without preselection',
    'Slotted images',
    'Slots',
    'Set Value',
    'With optgroups',
    'Custom asynchronous filtering',
    'Custom option rendering',
  ]}
/>

## Form

The `p-select` can be integrated into a form in two ways: **controlled** or **uncontrolled**, depending on your needs.

In the **controlled** approach, the select state is externally managed using the `value` property and `change` event to
keep it in sync with your application logic. This approach is ideal for complex forms or when using a form library. Note
that the component will still always update its internal value automatically when interacted with.

In the **uncontrolled** approach, the select behaves similar to a native `<select>`, automatically managing its own
state and including its value in form submissions through the
[ElementInternals](https://developer.mozilla.org/en-US/docs/Web/API/ElementInternals) API. This is convenient for
smaller forms or simple submissions.

<Notification heading="Attention" heading-tag="h2" state="warning">
  <code>p-select</code> does not use a native select internally. As a result, it lacks access to native{' '}
  <code>ValidityState</code>
  properties and <code>validationMessage</code>, and it cannot display the native validation popover. This means
  validation behavior and error display will need to be implemented separately if required.
</Notification>

For more details on form integration, refer to the `Form` section in the
[developing documentation](/developing/introduction) for your framework of choice, or find a full form integration
example in our [examples repository](https://github.com/porsche-design-system/examples/tree/v3/frameworks).

<ComponentExample codeSample={selectExampleForm} />

## Basic example without preselection

To ensure the user makes a conscious choice, use the initial value `undefined` of the `value` property. If you want to
give the user the choice to deselect the current option, you can provide an option without a value
`<p-select-option></p-select-option>`. If you don't want the user to be able to deselect the current option, but still
want to show a placeholder text you can set the option `disabled` like this
`<p-select-option disabled>Please choose an option</p-select-option>`.

<ComponentExample codeSample={selectExampleRequired} />

## Slotted images

In order to show an icon for each option, you can optionally slot an `img` tag within the `p-select-option`. Be aware
that the `p-select-option` can only contain a `#text` and an `img` node.

<ComponentStory story={selectStorySlottedImages} />

## Slots

Sometimes it's useful to render custom markup for `label`, `description` or `message`. Therefore, named slots can be
used. Make sure **not** to define the corresponding property on the host element when a named slot is used (because a
property definition is preferred over a named slot). For named slots only
[phrasing content](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories#Phrasing_content) is
allowed.

In addition to the named slots `label`, `description` and `message`, there is also a `label-after` slot available. This slot must be used to render content after the label which is not directly part of it (e.g. an external link or a `popover` component).

<ComponentStory story={selectStorySlots} />

---

## Set Value

The `p-select` component behaves like regular form elements. It updates its value automatically based on user choices,
but can also be changed manually by using the value property. This property takes a string that represent the selected
option value.

<ComponentExample codeSample={selectExampleDynamic} />

---

## With optgroups

<ComponentStory story={selectStoryOptgroups} />

---

## Custom asynchronous filtering

The `p-select` component automatically filters options based on user input. However, if you have a large dataset or need
custom filtering logic (for example, server-side filtering), you can override this behavior using the `filter` slot.

To do so, place a `p-input-search` inside the `filter` slot and bind it as shown in the example. Handle user input and
option fetching manually to control filtering behavior. Be sure to include custom loading, no results, and error states,
as these are not provided automatically when using the controlled filtering approach.

<ComponentExample codeSample={selectExampleAsyncFilter} />

## Custom option rendering

By default, `p-select-option` only allows `#text` and `img` nodes. To customize option rendering further, implement a
custom selection renderer using the `selected` slot. This allows you to render different content in the selected area
versus the dropdown options, enabling more complex option layouts.

When using the `filter` option, the default behavior filters against all `textContent` within the options. For more
granular control over filtering, implement custom filtering logic as shown in the
[previous example](/components/select/examples#custom-asynchronous-filtering).

<ComponentExample codeSample={selectExampleSelectedSlot} />
