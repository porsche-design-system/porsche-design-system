#!/usr/bin/env bash

set -o errexit
set -o pipefail

SCRIPT_DIR="$(cd `dirname ${0}` && pwd)"
source "${SCRIPT_DIR}/../shared/ensure-cdn-credentials.sh"

function upload {
  echo "task: [$(date)] \"upload\" (${1}, ${2})"

  # check if directory exists after stripping away everything after last slash
  if [ -d $(echo "${1}" | sed "s|\(.*\)/.*|\1|") ]; then
    rsync -av --stats --ignore-existing -e "ssh -p22 -oUserKnownHostsFile=/dev/null -oStrictHostKeyChecking=no" ${1} ${CDN_USER}@rsync.ams.B2820.taucdn.net:"/assets/porsche-design-system/${2}"
    echo "files in directory '${1}' have been uploaded to cdn âœ…"
  else
    echo "directory '${1}' does not exist, skipping upload ðŸ”œ"
  fi
}

upload "packages/marque/dist/marque/*" marque/
upload "packages/icons/dist/icons/*" icons/
upload "packages/fonts/dist/fonts/font-face.min.*.css" fonts/
upload "packages/fonts/dist/fonts/*.woff" fonts/
upload "packages/fonts/dist/fonts/*.woff2" fonts/
upload "packages/components-pwcm/dist/cdn/data/*" pwcm/
