#!/usr/bin/env bash

set -o errexit
set -o pipefail

if [[ -z "${1}" ]]; then
  echo "Please provide a target version, e.g. './docker.sh run-prepare-release-utilities 1.2.3'"
  exit 1
fi

pushd "packages/utilities/projects/utilities"
  yarn version --no-git-tag-version --new-version "${1}"
  sed -i -e "s/### \[Unreleased\]/### \[Unreleased\]\n\n### \[${1}\] - $(date +'%F')/" "./CHANGELOG.md"
popd

pushd "./packages/assets"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd

pushd "./packages/components-angular"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd

pushd "./packages/components-js"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd

pushd "./packages/components-react"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd

pushd "./packages/storefront"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd

pushd "./packages/utils"
  sed -i -e "s/\"@porsche-design-system\/utilities\": \".*\"/\"@porsche-design-system\/utilities\": \"${1}\"/" "./package.json"
popd
